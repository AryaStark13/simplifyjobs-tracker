<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Grad Job Application Tracker</title>
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            line-height: 1.5;
            color: #1f2937;
            background-color: #f9fafb;
            font-size: 14px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }

        .header {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 8px;
        }

        .header-description {
            color: #6b7280;
            margin-bottom: 16px;
            line-height: 1.6;
        }

        .how-to-use {
            background: #f3f4f6;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 16px;
        }

        .how-to-use h3 {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .how-to-use ul {
            list-style: none;
            color: #6b7280;
        }

        .how-to-use li {
            margin-bottom: 4px;
            padding-left: 16px;
            position: relative;
        }

        .how-to-use li::before {
            content: "•";
            position: absolute;
            left: 0;
            color: #3b82f6;
            font-weight: bold;
        }

        .legend {
            background: #f3f4f6;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 16px;
        }

        .legend h3 {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .legend ul {
            list-style: none;
            color: #6b7280;
        }

        .legend li {
            margin-bottom: 4px;
            padding-left: 16px;
            position: relative;
        }

        .legend li::before {
            content: "•";
            position: absolute;
            left: 0;
            color: #3b82f6;
            font-weight: bold;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .stat-card {
            background: white;
            border: 1px solid #e5e7eb;
            padding: 16px;
            border-radius: 6px;
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: #111827;
            display: block;
        }

        .stat-label {
            font-size: 12px;
            color: #6b7280;
            font-weight: 500;
            margin-top: 4px;
        }

        .tab-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .tab-btn {
            padding: 10px 20px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            background: white;
            color: #374151;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }

        .tab-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .tab-content {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .applied-jobs-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .applied-jobs-table th {
            background: #f8fafc;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
        }

        .applied-jobs-table td {
            padding: 12px;
            border-bottom: 1px solid #f3f4f6;
            font-size: 13px;
            vertical-align: top;
        }

        .applied-job-row {
            transition: background-color 0.15s;
        }

        .applied-job-row:hover {
            background: #f9fafb;
        }

        .applied-job-row.offer {
            background: #d1fae5;
        }

        .applied-job-row.interview {
            background: #fef3c7;
        }

        .applied-job-row.rejected {
            background: #fee2e2;
        }

        .applied-status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-applied { background: #dbeafe; color: #1d4ed8; }
        .status-oa-received { background: #fef3c7; color: #92400e; }
        .status-oa-solved { background: #d1fae5; color: #065f46; }
        .status-interview-call { background: #e0e7ff; color: #3730a3; }
        .status-offer { background: #d1fae5; color: #065f46; }
        .status-rejected { background: #fee2e2; color: #991b1b; }
        .status-ghosted { background: #f3f4f6; color: #6b7280; }

        .controls {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .controls-row {
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }

        .search-box:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .update-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .update-btn:hover {
            background: #2563eb;
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 13px;
            background: white;
            color: #374151;
        }

        .filter-btn:hover {
            background: #f9fafb;
        }

        .filter-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .section {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 24px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .section-header {
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            user-select: none;
        }

        .section-header:hover {
            background: #f1f5f9;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            font-size: 16px;
            color: #111827;
        }

        .section-icon {
            font-size: 18px;
        }

        .collapse-icon {
            font-size: 12px;
            color: #6b7280;
            transition: transform 0.2s;
        }

        .section.collapsed .collapse-icon {
            transform: rotate(-90deg);
        }

        .section-content {
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .section.collapsed .section-content {
            max-height: 0;
        }

        .job-table {
            width: 100%;
            border-collapse: collapse;
        }

        .job-table th {
            background: #f8fafc;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            color: #374151;
            border-bottom: 1px solid #e5e7eb;
        }

        .job-table td {
            padding: 12px;
            border-bottom: 1px solid #f3f4f6;
            font-size: 13px;
        }

        .job-row {
            transition: background-color 0.15s;
        }

        .job-row:hover {
            background: #f9fafb;
        }

        .job-row.applied {
            background: #f0fdf4;
        }

        .job-row.applied:hover {
            background: #ecfdf5;
        }

        .checkbox-cell {
            width: 40px;
            text-align: center;
        }

        .checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .company-cell {
            font-weight: 600;
            color: #111827;
            min-width: 150px;
        }

        .role-cell {
            color: #374151;
            max-width: 300px;
        }

        .location-cell {
            color: #6b7280;
            max-width: 200px;
        }

        .age-cell {
            color: #9ca3af;
            text-align: center;
            min-width: 80px;
        }

        .status-cell {
            min-width: 120px;
        }

        .status-select {
            width: 100%;
            padding: 4px 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 12px;
            background: white;
        }

        .status-select:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .apply-cell {
            text-align: center;
            min-width: 80px;
        }

        .apply-btn {
            background: #059669;
            color: white;
            padding: 6px 12px;
            text-decoration: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            display: inline-block;
        }

        .apply-btn:hover {
            background: #047857;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }

        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .update-status {
            margin-bottom: 16px;
            padding: 12px 16px;
            border-radius: 6px;
            font-weight: 500;
            font-size: 14px;
        }

        .update-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .update-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            .controls-row {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }

            .update-btn {
                width: 100%;
                justify-content: center;
            }

            .filter-buttons {
                justify-content: center;
            }

            .job-table {
                font-size: 12px;
            }

            .job-table th,
            .job-table td {
                padding: 8px 6px;
            }

            .section-title {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>New Grad Job Application Tracker</h1>
            <div class="header-description">
                This application automatically pulls the latest job listings from the 
                <a href="https://github.com/SimplifyJobs/New-Grad-Positions" target="_blank">SimplifyJobs repository</a> 
                and helps you track your 2026 New Grad position applications with status management and progress monitoring.
            </div>
            
            <div class="legend" style="background: #e0f2fe; border: 1px solid #0288d1; margin-bottom: 16px;">
                <h3 style="color: #01579b;">📱 Data Storage Info:</h3>
                <div style="color: #0277bd; font-size: 13px;">
                    Your application status and progress are saved locally in your browser and <strong>persist across page refreshes</strong>. 
                    However, this data is <strong>device-specific</strong> and won't sync across different browsers/devices. 
                    Data will be lost if you clear browser data, use incognito mode, or switch devices.
                    <br><strong>💾 Backup Solution:</strong> Use Export/Import buttons above to transfer data between devices.
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                <div class="how-to-use">
                    <h3>How to Use:</h3>
                    <ul>
                        <li>Check the box next to jobs you've applied to and update status as you progress</li>
                        <li>Just refresh to update the latest jobs from SimplifyJobs</li>
                        <li>Use filters and search to find relevant positions and track your application pipeline</li>
                        <li>Jobs that you don't update for 3 months are automatically transitioned to "Ghosted"</li>
                    </ul>
                </div>
                
                <div class="legend">
                    <h3>Legend (Searchable):</h3>
                    <ul>
                        <li>🛂 Does NOT offer sponsorship</li>
                        <li>🇺🇸 Requires U.S. Citizenship</li>
                        <li>🔒 Job application is closed</li>
                        <li>🔥 FAANG+ company</li>
                    </ul>
                    <div style="font-size: 12px; color: #6b7280; margin-top: 8px;">
                        💡 Tip: Search using emojis (e.g., "🔥" for FAANG companies)
                    </div>
                </div>
            </div>

            <div class="stats">
                <div class="stat-card">
                    <span class="stat-number" id="total-jobs">0</span>
                    <span class="stat-label">Total Jobs</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="applied-count">0</span>
                    <span class="stat-label">Applied</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="remaining-count">0</span>
                    <span class="stat-label">Not Applied</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="ghosted-count">0</span>
                    <span class="stat-label">Ghosted</span>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="controls-row">
                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="browse" onclick="switchTab('browse')">
                        📋 Browse Jobs
                    </button>
                    <button class="tab-btn" data-tab="applied" onclick="switchTab('applied')">
                        ✅ Applied Jobs
                    </button>
                </div>
            </div>
            
            <div id="browse-controls" class="tab-content">
                <div class="controls-row">
                    <input type="text" class="search-box" id="search" placeholder="Search companies, roles, or locations...">
                    <button class="update-btn" onclick="updateJobsFromGitHub()">
                        <span>🔄</span>
                        Update Jobs
                    </button>
                    <button class="update-btn" style="background: #059669;" onclick="exportData()">
                        <span>📥</span>
                        Export Data
                    </button>
                    <button class="update-btn" style="background: #dc2626;" onclick="document.getElementById('import-file').click()">
                        <span>📤</span>
                        Import Data
                    </button>
                    <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importData(event)">
                </div>
                <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="all">All Jobs</button>
                    <button class="filter-btn" data-filter="not-applied">Not Applied</button>
                    <button class="filter-btn" data-filter="applied">Applied</button>
                    <button class="filter-btn" data-filter="oa-received">OA Received</button>
                    <button class="filter-btn" data-filter="oa-solved">OA Solved</button>
                    <button class="filter-btn" data-filter="interview-call">Interview</button>
                    <button class="filter-btn" data-filter="offer">Offer</button>
                    <button class="filter-btn" data-filter="rejected">Rejected</button>
                    <button class="filter-btn" data-filter="ghosted">Ghosted</button>
                </div>
            </div>

            <div id="applied-controls" class="tab-content" style="display: none;">
                <div class="controls-row">
                    <input type="text" class="search-box" id="applied-search" placeholder="Search your applied jobs...">
                    <button class="update-btn" style="background: #059669;" onclick="exportAppliedJobs()">
                        <span>📥</span>
                        Export Applied Jobs CSV
                    </button>
                </div>
                <div class="applied-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 12px; margin-top: 12px;">
                    <div class="stat-card" style="padding: 12px;">
                        <span class="stat-number" id="applied-total">0</span>
                        <span class="stat-label">Total Applied</span>
                    </div>
                    <div class="stat-card" style="padding: 12px;">
                        <span class="stat-number" id="applied-pending">0</span>
                        <span class="stat-label">Pending</span>
                    </div>
                    <div class="stat-card" style="padding: 12px;">
                        <span class="stat-number" id="applied-interviews">0</span>
                        <span class="stat-label">Interviews</span>
                    </div>
                    <div class="stat-card" style="padding: 12px;">
                        <span class="stat-number" id="applied-offers">0</span>
                        <span class="stat-label">Offers</span>
                    </div>
                    <div class="stat-card" style="padding: 12px;">
                        <span class="stat-number" id="applied-rejected">0</span>
                        <span class="stat-label">Rejected</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="update-status"></div>
        
        <div id="browse-content" class="tab-content">
            <div id="job-sections"></div>
        </div>

        <div id="applied-content" class="tab-content" style="display: none;">
            <div id="applied-jobs-container"></div>
        </div>
    </div>

    <script>
        // Application state
        let allJobs = [];
        let appliedJobs = new Set();
        let jobStatuses = {};
        let currentFilter = 'all';
        let searchTerm = '';
        let appliedSearchTerm = '';
        let collapsedSections = new Set();
        let currentTab = 'browse';

        const statusOptions = [
            { value: 'not-applied', label: 'Not Applied' },
            { value: 'applied', label: 'Applied' },
            { value: 'oa-received', label: 'OA Received' },
            { value: 'oa-solved', label: 'OA Solved' },
            { value: 'interview-call', label: 'Interview Call' },
            { value: 'offer', label: 'Offer' },
            { value: 'rejected', label: 'Rejected' },
            { value: 'ghosted', label: 'Ghosted' }
        ];

        // Load data from localStorage
        function loadAppData() {
            const savedApplied = localStorage.getItem('appliedJobs');
            if (savedApplied) {
                appliedJobs = new Set(JSON.parse(savedApplied));
            }

            const savedStatuses = localStorage.getItem('jobStatuses');
            if (savedStatuses) {
                jobStatuses = JSON.parse(savedStatuses);
            }

            const savedCollapsed = localStorage.getItem('collapsedSections');
            if (savedCollapsed) {
                collapsedSections = new Set(JSON.parse(savedCollapsed));
            }
        }

        // Save data to localStorage
        function saveAppData() {
            localStorage.setItem('appliedJobs', JSON.stringify([...appliedJobs]));
            localStorage.setItem('jobStatuses', JSON.stringify(jobStatuses));
            localStorage.setItem('collapsedSections', JSON.stringify([...collapsedSections]));
        }

        // Check for ghosted applications (3+ months with no status update)
        function checkGhostedApplications() {
            const threeMonthsAgo = new Date();
            threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);

            Object.keys(jobStatuses).forEach(jobId => {
                const statusData = jobStatuses[jobId];
                if (statusData.status === 'applied' && statusData.lastUpdated) {
                    const lastUpdate = new Date(statusData.lastUpdated);
                    if (lastUpdate < threeMonthsAgo) {
                        jobStatuses[jobId].status = 'ghosted';
                        jobStatuses[jobId].lastUpdated = new Date().toISOString();
                    }
                }
            });
            saveAppData();
        }

        // Generate unique job ID
        function generateJobId(job) {
            return `${job.company}-${job.role}-${job.location}`.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
        }

        // Parse job data from README content (FIXED for HTML tables)
        function parseJobData(readmeContent) {
            const jobs = [];
            
            // Parse AI/ML jobs
            const aimlSection = readmeContent.match(/## 🤖 Data Science, AI & Machine Learning New Grad Roles[\s\S]*?(?=## |$)/);
            if (aimlSection) {
                const aimlJobs = parseHTMLJobTable(aimlSection[0], 'AI/ML');
                jobs.push(...aimlJobs);
            }

            // Parse Software Engineering jobs
            const sweSection = readmeContent.match(/## 💻 Software Engineering New Grad Roles[\s\S]*?(?=## |$)/);
            if (sweSection) {
                const sweJobs = parseHTMLJobTable(sweSection[0], 'Software Engineering');
                jobs.push(...sweJobs);
            }

            // Parse Product Management jobs
            const pmSection = readmeContent.match(/## 📱 Product Management New Grad Roles[\s\S]*?(?=## |$)/);
            if (pmSection) {
                const pmJobs = parseHTMLJobTable(pmSection[0], 'Product Management');
                jobs.push(...pmJobs);
            }

            // Parse Quantitative Finance jobs
            const quantSection = readmeContent.match(/## 📈 Quantitative Finance New Grad Roles[\s\S]*?(?=## |$)/);
            if (quantSection) {
                const quantJobs = parseHTMLJobTable(quantSection[0], 'Quantitative Finance');
                jobs.push(...quantJobs);
            }

            // Parse Hardware Engineering jobs
            const hwSection = readmeContent.match(/## 🔧 Hardware Engineering New Grad Roles[\s\S]*?(?=## |$)/);
            if (hwSection) {
                const hwJobs = parseHTMLJobTable(hwSection[0], 'Hardware Engineering');
                jobs.push(...hwJobs);
            }

            // Parse Other jobs
            const otherSection = readmeContent.match(/## 💼 Other New Grad Roles[\s\S]*?(?=## |$)/);
            if (otherSection) {
                const otherJobs = parseHTMLJobTable(otherSection[0], 'Other');
                jobs.push(...otherJobs);
            }

            return jobs;
        }

        // Parse HTML job table (FIXED)
        function parseHTMLJobTable(sectionContent, category) {
            const jobs = [];
            
            // Create a temporary div to parse HTML
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = sectionContent;
            
            // Find the table
            const table = tempDiv.querySelector('table');
            if (!table) {
                console.log(`No table found for ${category}`);
                return jobs;
            }
            
            // Get all table rows, skip the header row
            const rows = table.querySelectorAll('tbody tr');
            
            let lastCompany = '';
            
            rows.forEach((row, index) => {
                const cells = row.querySelectorAll('td');
                
                if (cells.length >= 4) {
                    let companyText = cells[0].textContent.trim();
                    const roleText = cells[1].textContent.trim();
                    const locationText = cells[2].textContent.trim();
                    const applicationCell = cells[3];
                    const ageText = cells.length > 4 ? cells[4].textContent.trim() : 'N/A';
                    
                    // Skip if application is closed
                    if (applicationCell.textContent.includes('🔒')) {
                        return;
                    }
                    
                    // Handle continuation rows (↳)
                    if (companyText.includes('↳')) {
                        companyText = lastCompany;
                    } else {
                        lastCompany = companyText;
                    }
                    
                    // Extract application URL
                    const linkElement = applicationCell.querySelector('a');
                    const applicationUrl = linkElement ? linkElement.href : '';
                    
                    // Check for flags
                    const noSponsorship = 
                        companyText.includes('🛂') || 
                        roleText.includes('🛂') || 
                        applicationCell.textContent.includes('🛂');
                    
                    const usCitizenship = 
                        companyText.includes('🇺🇸') || 
                        roleText.includes('🇺🇸') || 
                        applicationCell.textContent.includes('🇺🇸');
                    
                    // Clean up text - keep emojis for searchability
                    const cleanCompany = extractCompanyName(companyText);
                    const cleanRole = roleText.trim(); // Keep emojis in role names too
                    const cleanLocation = locationText.replace(/🛂|🇺🇸/g, '').trim(); // Remove from location only
                    
                    // Validate job data
                    if (!cleanCompany || !cleanRole || cleanCompany.length < 2) {
                        return;
                    }
                    
                    const job = {
                        category,
                        company: cleanCompany,
                        role: cleanRole,
                        location: cleanLocation,
                        applicationUrl,
                        age: ageText || 'N/A',
                        noSponsorship,
                        usCitizenship,
                        id: generateJobId({ company: cleanCompany, role: cleanRole, location: cleanLocation })
                    };
                    
                    jobs.push(job);
                }
            });
            
            console.log(`Parsed ${jobs.length} jobs for ${category}`);
            return jobs;
        }

        function extractCompanyName(companyText) {
            if (companyText.includes('↳')) return '';
            
            // Remove HTML tags and extract text
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = companyText;
            let text = tempDiv.textContent || tempDiv.innerText || '';
            
            // Keep emojis for searchability - only trim whitespace
            text = text.trim();
            
            return text;
        }

        // Get job status
        function getJobStatus(jobId) {
            return jobStatuses[jobId]?.status || 'not-applied';
        }

        // Update job status
        function updateJobStatus(jobId, status) {
            if (!jobStatuses[jobId]) {
                jobStatuses[jobId] = {};
            }
            jobStatuses[jobId].status = status;
            jobStatuses[jobId].lastUpdated = new Date().toISOString();
            
            // Update applied jobs set based on status
            if (status === 'not-applied') {
                appliedJobs.delete(jobId);
            } else {
                appliedJobs.add(jobId);
            }
            
            saveAppData();
            updateStats();
        }

        // Update job statistics
        function updateStats() {
            const statusCounts = {};
            statusOptions.forEach(option => {
                statusCounts[option.value] = 0;
            });

            allJobs.forEach(job => {
                const status = getJobStatus(job.id);
                statusCounts[status]++;
            });

            document.getElementById('total-jobs').textContent = allJobs.length;
            document.getElementById('applied-count').textContent = allJobs.length - statusCounts['not-applied'];
            document.getElementById('remaining-count').textContent = statusCounts['not-applied'];
            document.getElementById('ghosted-count').textContent = statusCounts['ghosted'];
        }

        // Filter jobs based on current criteria
        function getFilteredJobs() {
            return allJobs.filter(job => {
                // Apply search filter
                if (searchTerm) {
                    const searchLower = searchTerm.toLowerCase();
                    const matchesSearch = 
                        job.company.toLowerCase().includes(searchLower) ||
                        job.role.toLowerCase().includes(searchLower) ||
                        job.location.toLowerCase().includes(searchLower);
                    if (!matchesSearch) return false;
                }

                // Apply status filter
                const jobStatus = getJobStatus(job.id);
                if (currentFilter !== 'all' && jobStatus !== currentFilter) return false;

                return true;
            });
        }

        // Switch between tabs
        function switchTab(tab) {
            currentTab = tab;
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
            
            // Show/hide tab content
            document.getElementById('browse-controls').style.display = tab === 'browse' ? 'block' : 'none';
            document.getElementById('applied-controls').style.display = tab === 'applied' ? 'block' : 'none';
            document.getElementById('browse-content').style.display = tab === 'browse' ? 'block' : 'none';
            document.getElementById('applied-content').style.display = tab === 'applied' ? 'block' : 'none';
            
            if (tab === 'applied') {
                renderAppliedJobs();
            } else {
                renderJobs();
            }
        }

        // Get applied jobs with details
        function getAppliedJobsWithDetails() {
            return allJobs.filter(job => {
                const status = getJobStatus(job.id);
                return status !== 'not-applied';
            }).map(job => {
                const statusData = jobStatuses[job.id];
                return {
                    ...job,
                    status: statusData?.status || 'applied',
                    appliedDate: statusData?.lastUpdated ? new Date(statusData.lastUpdated).toLocaleDateString() : 'Unknown',
                    statusDate: statusData?.lastUpdated ? new Date(statusData.lastUpdated).toLocaleDateString() : 'Unknown'
                };
            }).sort((a, b) => {
                // Sort by status date, most recent first
                const dateA = jobStatuses[a.id]?.lastUpdated ? new Date(jobStatuses[a.id].lastUpdated) : new Date(0);
                const dateB = jobStatuses[b.id]?.lastUpdated ? new Date(jobStatuses[b.id].lastUpdated) : new Date(0);
                return dateB - dateA;
            });
        }

        // Update applied jobs statistics
        function updateAppliedStats() {
            const appliedJobsList = getAppliedJobsWithDetails();
            const statusCounts = {
                total: appliedJobsList.length,
                pending: 0,
                interviews: 0,
                offers: 0,
                rejected: 0
            };

            appliedJobsList.forEach(job => {
                switch (job.status) {
                    case 'applied':
                    case 'oa-received':
                    case 'oa-solved':
                        statusCounts.pending++;
                        break;
                    case 'interview-call':
                        statusCounts.interviews++;
                        break;
                    case 'offer':
                        statusCounts.offers++;
                        break;
                    case 'rejected':
                    case 'ghosted':
                        statusCounts.rejected++;
                        break;
                }
            });

            document.getElementById('applied-total').textContent = statusCounts.total;
            document.getElementById('applied-pending').textContent = statusCounts.pending;
            document.getElementById('applied-interviews').textContent = statusCounts.interviews;
            document.getElementById('applied-offers').textContent = statusCounts.offers;
            document.getElementById('applied-rejected').textContent = statusCounts.rejected;
        }

        // Render applied jobs table
        function renderAppliedJobs() {
            let appliedJobsList = getAppliedJobsWithDetails();

            // Apply search filter
            if (appliedSearchTerm) {
                const searchLower = appliedSearchTerm.toLowerCase();
                appliedJobsList = appliedJobsList.filter(job => 
                    job.company.toLowerCase().includes(searchLower) ||
                    job.role.toLowerCase().includes(searchLower) ||
                    job.location.toLowerCase().includes(searchLower) ||
                    job.status.toLowerCase().includes(searchLower)
                );
            }

            updateAppliedStats();

            if (appliedJobsList.length === 0) {
                document.getElementById('applied-jobs-container').innerHTML = `
                    <div class="loading">
                        ${appliedSearchTerm ? 'No applied jobs match your search.' : 'No applications yet. Start applying to jobs from the Browse Jobs tab!'}
                    </div>
                `;
                return;
            }

            const tableHTML = `
                <table class="applied-jobs-table">
                    <thead>
                        <tr>
                            <th>Company</th>
                            <th>Job Title</th>
                            <th>Location</th>
                            <th>Category</th>
                            <th>Status</th>
                            <th>Applied Date</th>
                            <th>Last Updated</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${appliedJobsList.map(job => {
                            const statusClass = job.status.replace('-', '');
                            const rowClass = job.status === 'offer' ? 'offer' : 
                                            job.status === 'interview-call' ? 'interview' :
                                            (job.status === 'rejected' || job.status === 'ghosted') ? 'rejected' : '';
                            
                            return `
                                <tr class="applied-job-row ${rowClass}">
                                    <td style="font-weight: 600;">${job.company}</td>
                                    <td>${job.role}</td>
                                    <td style="color: #6b7280;">${job.location}</td>
                                    <td>
                                        <span style="background: #f3f4f6; padding: 2px 6px; border-radius: 4px; font-size: 11px; color: #374151;">
                                            ${job.category}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="applied-status-badge status-${statusClass}">
                                            ${statusOptions.find(opt => opt.value === job.status)?.label || job.status}
                                        </span>
                                    </td>
                                    <td style="color: #6b7280;">${job.appliedDate}</td>
                                    <td style="color: #6b7280;">${job.statusDate}</td>
                                    <td>
                                        <div style="display: flex; gap: 8px;">
                                            ${job.applicationUrl ? `<a href="${job.applicationUrl}" target="_blank" class="apply-btn" style="padding: 4px 8px; font-size: 11px;">View Job</a>` : ''}
                                            <select class="status-select" onchange="updateJobStatus('${job.id}', this.value)" style="font-size: 11px; padding: 2px 4px;">
                                                ${statusOptions.map(option => 
                                                    `<option value="${option.value}" ${job.status === option.value ? 'selected' : ''}>${option.label}</option>`
                                                ).join('')}
                                            </select>
                                        </div>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('applied-jobs-container').innerHTML = tableHTML;
        }

        // Export applied jobs as CSV (similar to Simplify Jobs format)
        function exportAppliedJobs() {
            const appliedJobsList = getAppliedJobsWithDetails();
            
            if (appliedJobsList.length === 0) {
                const statusDiv = document.getElementById('update-status');
                statusDiv.innerHTML = '<div class="update-status update-error">❌ No applied jobs to export!</div>';
                setTimeout(() => statusDiv.innerHTML = '', 3000);
                return;
            }

            // Create CSV content
            const headers = ['Job Title', 'Company Name', 'Job URL', 'Applied Date', 'Status', 'Status Date', 'Category', 'Location', 'Notes'];
            const csvContent = [
                headers.join(','),
                ...appliedJobsList.map(job => [
                    `"${job.role}"`,
                    `"${job.company}"`,
                    `"${job.applicationUrl || ''}"`,
                    `"${job.appliedDate}"`,
                    `"${statusOptions.find(opt => opt.value === job.status)?.label || job.status}"`,
                    `"${job.statusDate}"`,
                    `"${job.category}"`,
                    `"${job.location}"`,
                    `""` // Notes column (empty for now)
                ].join(','))
            ].join('\n');

            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `applied-jobs-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);

            // Show success message
            const statusDiv = document.getElementById('update-status');
            statusDiv.innerHTML = `<div class="update-status update-success">📥 Exported ${appliedJobsList.length} applied jobs to CSV!</div>`;
            setTimeout(() => statusDiv.innerHTML = '', 3000);
        }

        // Render jobs
        function renderJobs() {
            const filteredJobs = getFilteredJobs();
            const jobsByCategory = {};

            filteredJobs.forEach(job => {
                if (!jobsByCategory[job.category]) {
                    jobsByCategory[job.category] = [];
                }
                jobsByCategory[job.category].push(job);
            });

            const categoryOrder = ['AI/ML', 'Software Engineering', 'Product Management', 'Quantitative Finance', 'Hardware Engineering', 'Other'];
            const categoryIcons = {
                'AI/ML': '🤖',
                'Software Engineering': '💻',
                'Product Management': '📱',
                'Quantitative Finance': '📈',
                'Hardware Engineering': '🔧',
                'Other': '💼'
            };

            let html = '';
            categoryOrder.forEach(category => {
                if (jobsByCategory[category] && jobsByCategory[category].length > 0) {
                    const isCollapsed = collapsedSections.has(category);
                    html += `
                        <div class="section ${isCollapsed ? 'collapsed' : ''}">
                            <div class="section-header" onclick="toggleSection('${category}')">
                                <div class="section-title">
                                    <span class="section-icon">${categoryIcons[category]}</span>
                                    <span>${category} (${jobsByCategory[category].length})</span>
                                </div>
                                <span class="collapse-icon">▼</span>
                            </div>
                            <div class="section-content" style="max-height: ${isCollapsed ? '0' : '10000px'}">
                                <table class="job-table">
                                    <thead>
                                        <tr>
                                            <th class="checkbox-cell">✓</th>
                                            <th>Company</th>
                                            <th>Role</th>
                                            <th>Location</th>
                                            <th>Status</th>
                                            <th>Age</th>
                                            <th>Apply</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${renderJobRows(jobsByCategory[category])}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                }
            });

            document.getElementById('job-sections').innerHTML = html || '<div class="loading">No jobs found matching your criteria.</div>';
            updateStats();
        }

        // Render job rows
        function renderJobRows(jobs) {
            return jobs.map(job => {
                const status = getJobStatus(job.id);
                const isApplied = status !== 'not-applied';
                
                return `
                    <tr class="job-row ${isApplied ? 'applied' : ''}" data-job-id="${job.id}">
                        <td class="checkbox-cell">
                            <input type="checkbox" class="checkbox" 
                                   ${isApplied ? 'checked' : ''} 
                                   onchange="toggleApplication('${job.id}')">
                        </td>
                        <td class="company-cell">${job.company}</td>
                        <td class="role-cell">${job.role}</td>
                        <td class="location-cell">${job.location}</td>
                        <td class="status-cell">
                            <select class="status-select" onchange="updateJobStatus('${job.id}', this.value)">
                                ${statusOptions.map(option => 
                                    `<option value="${option.value}" ${status === option.value ? 'selected' : ''}>${option.label}</option>`
                                ).join('')}
                            </select>
                        </td>
                        <td class="age-cell">${job.age}</td>
                        <td class="apply-cell">
                            ${job.applicationUrl ? `<a href="${job.applicationUrl}" target="_blank" class="apply-btn">Apply</a>` : ''}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Toggle application status
        function toggleApplication(jobId) {
            const currentStatus = getJobStatus(jobId);
            const newStatus = currentStatus === 'not-applied' ? 'applied' : 'not-applied';
            updateJobStatus(jobId, newStatus);
            renderJobs();
        }

        // Event listeners
        document.getElementById('search').addEventListener('input', (e) => {
            searchTerm = e.target.value;
            renderJobs();
        });

        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                currentFilter = e.target.dataset.filter;
                renderJobs();
            });
        });

        // Update jobs from GitHub
        async function updateJobsFromGitHub() {
            const statusDiv = document.getElementById('update-status');
            statusDiv.innerHTML = '<div class="update-status"><div class="spinner"></div>Fetching latest jobs from GitHub...</div>';

            try {
                const response = await fetch('https://raw.githubusercontent.com/SimplifyJobs/New-Grad-Positions/dev/README.md');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const readmeContent = await response.text();
                console.log('README content length:', readmeContent.length);
                
                allJobs = parseJobData(readmeContent);
                console.log('Total jobs parsed:', allJobs.length);
                
                // Save to localStorage for offline access
                localStorage.setItem('cachedJobs', JSON.stringify(allJobs));
                localStorage.setItem('lastUpdate', new Date().toISOString());
                
                // Check for ghosted applications after updating jobs
                checkGhostedApplications();

                // check how many new jobs were added
                const cached = localStorage.getItem('cachedJobs');
                const cachedJobs = cached ? JSON.parse(cached) : [];
                const newJobsCount = allJobs.length - cachedJobs.length;
                
                renderJobs();
                statusDiv.innerHTML = `<div class="update-status update-success">✅ Successfully added ${newJobsCount} job listings!</div>`;
                
                // Clear status after 3 seconds
                setTimeout(() => {
                    statusDiv.innerHTML = '';
                }, 3000);
                
            } catch (error) {
                console.error('Error updating jobs:', error);
                statusDiv.innerHTML = '<div class="update-status update-error">❌ Failed to update jobs. Using cached data.</div>';
                
                // Try to load from cache
                const cached = localStorage.getItem('cachedJobs');
                if (cached) {
                    allJobs = JSON.parse(cached);
                    renderJobs();
                }
                
                setTimeout(() => {
                    statusDiv.innerHTML = '';
                }, 5000);
            }
        }

        // Initialize app
        async function initApp() {
            loadAppData();
            
            // Try to load from cache first
            const cached = localStorage.getItem('cachedJobs');
            if (cached) {
                allJobs = JSON.parse(cached);
                checkGhostedApplications();
                renderJobs();
            }
            
            // Then update from GitHub
            await updateJobsFromGitHub();
        }

        // Auto-update every 30 minutes
        setInterval(updateJobsFromGitHub, 30 * 60 * 1000);

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initApp);

        // Export application data as JSON
        function exportData() {
            const exportData = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                appliedJobs: [...appliedJobs],
                jobStatuses: jobStatuses,
                totalJobs: allJobs.length,
                metadata: {
                    totalApplications: appliedJobs.size,
                    lastUpdate: localStorage.getItem('lastUpdate'),
                    categories: [...new Set(allJobs.map(job => job.category))]
                }
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `job-tracker-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);

            // Show success message
            const statusDiv = document.getElementById('update-status');
            statusDiv.innerHTML = '<div class="update-status update-success">📥 Application data exported successfully!</div>';
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 3000);
        }

        // Import application data from JSON file
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Validate the imported data structure
                    if (!importedData.appliedJobs || !importedData.jobStatuses) {
                        throw new Error('Invalid file format: Missing required data fields');
                    }

                    // Backup current data before importing (in case user wants to undo)
                    const backupData = {
                        appliedJobs: [...appliedJobs],
                        jobStatuses: { ...jobStatuses }
                    };
                    localStorage.setItem('preImportBackup', JSON.stringify(backupData));

                    // Import the data
                    appliedJobs = new Set(importedData.appliedJobs);
                    jobStatuses = importedData.jobStatuses;

                    // Save to localStorage
                    saveAppData();

                    // Re-render the interface
                    renderJobs();

                    // Show success message with stats
                    const totalImported = appliedJobs.size;
                    const importDate = new Date(importedData.exportDate).toLocaleDateString();
                    
                    const statusDiv = document.getElementById('update-status');
                    statusDiv.innerHTML = `
                        <div class="update-status update-success">
                            📤 Successfully imported ${totalImported} applications from backup (${importDate})!
                            <div style="margin-top: 8px; font-size: 12px;">
                                Previous data backed up automatically. Refresh to see updated statistics.
                            </div>
                        </div>
                    `;
                    
                    setTimeout(() => {
                        statusDiv.innerHTML = '';
                    }, 5000);

                } catch (error) {
                    console.error('Import error:', error);
                    const statusDiv = document.getElementById('update-status');
                    statusDiv.innerHTML = `
                        <div class="update-status update-error">
                            ❌ Import failed: ${error.message}
                            <div style="margin-top: 8px; font-size: 12px;">
                                Please ensure you're uploading a valid job tracker backup file.
                            </div>
                        </div>
                    `;
                    
                    setTimeout(() => {
                        statusDiv.innerHTML = '';
                    }, 5000);
                }
            };

            reader.readAsText(file);
            
            // Reset the file input so the same file can be imported again if needed
            event.target.value = '';
        }

        // Make functions globally available
        window.toggleApplication = toggleApplication;
        window.updateJobsFromGitHub = updateJobsFromGitHub;
        window.updateJobStatus = updateJobStatus;
        window.toggleSection = toggleSection;
        window.exportData = exportData;
        window.importData = importData;
    </script>
</body>
</html>